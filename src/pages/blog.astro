---
// src/pages/blog.astro
import BlogLayout from '../layouts/BlogLayout.astro';
import MainPostCard from '../components/content/MainPostCard.astro';
import BlogSearch from '../components/search/BlogSearch.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({ data }) => (
  import.meta.env.PROD ? !data.draft : true
))).sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate));

const mainPost =
  posts.find((p) => p.data?.main === true || p.data?.main === "true") ??
  posts[0];
---
<BlogLayout title="Learnelectronics Blog" description="Latest articles and updates">
  <section class="not-prose">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 items-start">

      <!-- Search: on top by default, right column on lg+ -->
      <aside class="order-1 lg:order-2 lg:col-span-1">
        <div class="lg:sticky top-24">
          <BlogSearch apiPath="/api/v1/search/search-blog" />
        </div>
      </aside>

      <!-- Main post: below on mobile, spans 3 columns on lg+ -->
      <div class="order-2 lg:order-1 lg:col-span-3">
        {mainPost && <MainPostCard post={mainPost} />}
      </div>

    </div>
  </section>
</BlogLayout>

