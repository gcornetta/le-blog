---
// src/components/content/BlogCard.astro
//card bg-base-100 border border-base-200 w-full rounded-box transition-shadow duration-300
import { Image } from 'astro:assets';
import { computePostMetadata } from '../../utils/content/postMetadata.mjs';

interface Props {
  post: CollectionEntry<'blog'>;
  featured?: boolean;
}

const { post, featured = false, } = Astro.props;
const { title, tags, heroImage, author } = post.data;
const { readingTime, excerpt } = computePostMetadata(post.body);

const pubDate = post.data.pubDate ? new Date(post.data.pubDate) : new Date();
const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric'
});
---

<div
  class={`card bg-base-100 border border-base-200 flex flex-col h-full rounded-box transition-shadow duration-300 ${
    featured ? 'shadow-lg hover:shadow-xl' : 'shadow-md hover:shadow-lg'
  }`}
>
  {heroImage && (
    <figure class="aspect-video overflow-hidden">
      <Image
        src={heroImage}
        alt={title}
        width={800}
        height={450}
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
        loading={featured ? 'eager' : 'lazy'}
      />
    </figure>
  )}

  <div class="card-body flex flex-col gap-3 flex-1">
    {tags?.length > 0 && (
      <div class="card-actions justify-start flex-wrap mb-1">
        {tags.slice(0, 3).map((tag) => (
          <div class="badge badge-outline badge-primary text-xs font-medium">
            {tag}
          </div>
        ))}
      </div>
    )}

    <h2 class="card-title text-xl line-clamp-2">
      <a href={`/blog/${post.slug}`} class="link link-hover">
        {title}
      </a>
    </h2>

    <div class="flex items-center gap-4 text-sm text-base-content/70 min-h-[2.5rem] overflow-hidden mb-2">
      <!-- Calendar icon + date -->
      <div class="flex items-center gap-1 shrink-0">
        <svg class="w-4 h-4 text-base-content/50" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <time datetime={pubDate.toISOString()}>
          {formattedDate}
        </time>
      </div>

      <!-- Clock icon + reading time -->
      <div class="flex items-center gap-1 shrink-0">
        <svg class="w-4 h-4 text-base-content/50" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 6v6l4 2m4-2a8 8 0 11-8-8 8 8 0 018 8z" />
        </svg>
        <span>{readingTime}</span>
      </div>
 
      <!-- Author icon + name -->
      {author && (
        <div class="flex items-center gap-1 flex-1 min-w-0">
          <svg class="w-4 h-4 text-base-content/50 shrink-0" fill="none" stroke="currentColor" stroke-width="2"
            viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
          <span class="truncate">{author}</span>
        </div>
      )}
    </div>

    <!-- Excerpt with quote icon -->
    <div class="relative border-l-4 border-primary pl-4 text-sm text-base-content/80 italic">
      <div class="flex gap-2 items-start">
        <svg class="w-5 h-5 text-primary mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 16 16">
          <path d="M7 10.4142L2.70711 14.7071L1.29289 13.2929L5 9.58579V9L1 9V2H7V10.4142Z"/>
          <path d="M9 9L13 9V9.58579L9.29289 13.2929L10.7071 14.7071L15 10.4142L15 2H9L9 9Z"/>
        </svg>
        <p class="line-clamp-3">{excerpt}</p>
      </div>
    </div>

    <div class="mt-auto pt-2 border-t border-base-200 text-sm flex justify-end items-center">
      <div class="card-actions justify-end">
        <a
          href={`/blog/${post.slug}`}
          class="btn btn-sm btn-ghost"
        >
          Read More
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    </div>
  </div>
</div>
